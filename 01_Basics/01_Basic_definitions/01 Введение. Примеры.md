
## Сеанса одновременной игры в шахматы

 - Чтобы сделать сеанс одновременной игры более динамичным и скоротечным, нужен **мастер-гроссмейстер**, который быстро делает ходы и не задерживается у доски каждого игрока.
 - В идеале он должен подходить к игрокам не по кругу, а только в момент, когда игрок завершил свой ход и ожидает ход гроссмейстера. Например, игрок делает ход, поднимает руку, чтобы к нему подошел гроссмейстер. В таком случае мастер не будет тратить время на ожидание хода очередного игрока, а будет только реагировать на события, подходя к каждому только для того, чтобы сделать свой ответный ход. Это действительно будет одновременной игрой, в которой одновременно участвуют несколько игроков.
 - Что еще замечательнее, если мы добавим каждому игроку по гроссмейстеру, общее время игры не изменится. Однако каждый из гроссмейстеров будет большую часть своего драгоценного времени просто ждать ответного хода игрока — это неразумная трата ценного времени мастера на простои

Пример с шахматами хорошо иллюстрирует принципы, которые необходимо соблюдать для эффекта одновременной игры:

1. Гроссмейстер должен быть по-настоящему мастером своего дела, совершать быстрые ходы и не задерживаться долго у доски каждого игрока. **Главный исполнитель не должен блокироваться.**
2. Игроки относительно самостоятельны. Они продолжают обдумывать свои ходы и возможные комбинации даже тогда, когда за их шахматной доской не стоит гроссмейстер. А также могут сделать свой ход до того, как к ним подойдет гроссмейстер. **Часть общей работы делегируется окружению (большую часть работы выполняет операционная система)**. Именно благодаря многозадачности операционных систем возможно повышение эффективности за счет асинхронного программирования (об этом мы еще не раз поговорим).
3. Наибольшая эффективность одновременной игры (наибольшая динамичность, наименьшее общее время игры) возможна в том случае, когда гроссмейстер не ждет хода игроков, а подходит к столу каждого участника только тогда, когда последний уже сделал свой ход. Этого можно добиться либо пригласив настоящих профессионалов (но где их столько найти?), либо изменив порядок подхода гроссмейстера к игроку. Пусть гроссмейстер подходит к игроку только тогда, когда игрок уже сделал свой ход. **Асинхронное выполнение всегда предполагает эффективное управление задачами по событию (по готовности), а для этого используется обработчик (диспетчер) событий, который создается явно или "под капотом" при использовании готовых асинхронных библиотек,** он так и называется цикл **событий.**

## Пример с кофемашинами

 Вам нужно наполнить 3 чашки кофе. Себе и коллегам. При этом у Вас в непосредственной доступности 3 кофемашины. Тогда у Вас несколько вариантов решения задачи:

- Действительно одновременный, **параллельный**. Говорите своим коллегам, что здесь слуг нет. Втроем идете к кофемашинам, подставляете чашки и ждете, пока чашки наполнятся. Ждете... ждете... Ждете втроем, и в конце концов каждый получает полную кружку кофе. Этот вариант решения для такой задачи кажется избыточным даже на интуитивном уровне. И уж точно не улучшит командную атмосферу в офисе.
- **Синхронный** вариант. Берете первую кружку, подставляете под аппарат, ждете пока приготовится кофе и наполнится кружка. Берете вторую кружку и повторяете. Потратите в три раза больше времени, но не будете отвлекать коллег и все так же в конечном итоге получите 3 кружки кофе.
- **Асинхронный** вариант. Берете три кружи, расставляете их по аппаратам и уходите по своим делам (например, идете покупать чипсы или залипаете в телефон), когда слышите сигнал от кофемашин, подходите и забираете наполненные кружки. При этом Вы не сильно больше потратите время, если Вам нужно будет приготовить 5 кружек кофе, если конечно у Вас будет 5 кофемашин.

А что если Вы работаете в кофейне? Большой автоматизированной сети, где Ваша задача всего лишь вовремя подставлять кружки под аппарат и выдавать наполненные кружки в окно выдачи.
У Вас одновременно могут наполняться сразу 5 кружек.
Подставить кружку занимает 2 секунды. 
Снять кружку и поставить ее в окно выдачи занимает еще пару секунд. Каждая кружка готовится (наполняется) около 30 секунд.
Заказы приходят неравномерно.
Даже в случае когда у Вас 10 кофемашин для одновременного приготовления 10 чашек, Вы будете простаивать.
Можно добавить еще машины без вреда для производительности. Да, возможно какая-то чашка простоит наполненной и готовой к выдаче на несколько секунд позже, но это не очень важно, если таким образом мы заметно увеличим производительность без необходимости найма еще одного работника.

 ---
 
 В обоих примерах для создания высокой производительности одного единственного исполнителя обязательно требуется:

1. Организация цикличного событийного выполнения. Что-то быстро сделал, взял следующее. Сделал ход, переходи к следующему игроку. Поставил чашку, бери и ставь другую.
2. Отсутствие блокировки на текущем выполнении. Делай ход быстро и не жди ответного хода игрока. Ставь чашку и не жди пока она наполнится.
3. Среда окружения может выполнять основную работу и позволяет делегировать это выполнение. У нас под рукой 10 кофемашин, только подставляй чашки. В комнате много игроков-шахматистов, которые думают над каждым ходом и делают свой ход, только успевай делать ответный ход.

